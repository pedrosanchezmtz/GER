<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Thu Oct 06 10:46:11 CDT 2022
  Author:  PedroSánchezMartínez
  Type: BPEL 2.0 Process
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="BPELValidationInvoicesAPEnt"
               targetNamespace="http://soa.estrellaroja.com.mx/ValidationInvoicesAPEnt/BPELValidationInvoicesAPEnt"
               xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
               xmlns:client="http://soa.estrellaroja.com.mx/ValidationInvoicesAPEnt/BPELValidationInvoicesAPEnt"
               xmlns:ora="http://schemas.oracle.com/xpath/extension"
               xmlns:ui="http://xmlns.oracle.com/soa/designer"
               xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:ess="http://xmlns.oracle.com/scheduler" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns1="http://soa.estrellaroja.com.mx/MessageTec"
         xmlns:ns2="http://soa.estrellaroja.com.mx/AuditControlTec"
         xmlns:ns4="http://soa.estrellaroja.com.mx/EstrellaRojaCommons"
         xmlns:ns3="http://soa.estrellaroja.com.mx/ValidationInvoicesAPEnt"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:ns5="http://soa.estrellaroja.com.mx/ERPIntegrationBiz"
         xmlns:ns6="http://soa.estrellaroja.com.mx/ValidationInvoicesAPBiz"
         xmlns:ns7="http://soa.estrellaroja.com.mx/Reports/XXER_AP_INVOICE_VALIDATION_AUTOMATICA">
   <import namespace="http://soa.estrellaroja.com.mx/Reports/XXER_AP_INVOICE_VALIDATION_AUTOMATICA"
           location="oramds:/apps/Common/Report/XXER_AP_INVOICE_VALIDATION_AUTOMATICA.xsd"
           importType="http://www.w3.org/2001/XMLSchema"/>
   <import location="oracle.xml.parser.v2.XMLElement" importType="http://schemas.oracle.com/bpel/extension/java"/>
   <import ui:processWSDL="true" namespace="http://soa.estrellaroja.com.mx/ValidationInvoicesAPEnt/BPELValidationInvoicesAPEnt" location="../WSDLs/BPELValidationInvoicesAPEnt.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    --> 
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="bpelvalidationinvoicesapent_client" partnerLinkType="client:BPELValidationInvoicesAPEnt" myRole="BPELValidationInvoicesAPEntProvider"/>
      <partnerLink name="WsMessageTec" partnerLinkType="ns1:WsMessageTec" partnerRole="MessageTecPortType"
                   myRole="MessageTecCallbackPortType"/>
      <partnerLink name="WsAuditControlTec" partnerLinkType="ns2:WsAuditControlTec"
                   partnerRole="AuditControlTecPortType"/>
      <partnerLink name="WsERPIntegrationBiz" partnerLinkType="ns5:WsERPIntegrationBiz"
                   partnerRole="ERPIntegrationBizPortType" myRole="ERPIntegrationBizCallbackPortType"/>
      <partnerLink name="WsValidationInvoicesAPBiz" partnerLinkType="ns6:WsValidationInvoicesAPBiz"
                   partnerRole="ValidationInvoicesAPBizPortType"/>
   </partnerLinks>

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->
    <variable name="inputVariable" messageType="client:BPELValidationInvoicesAPEntRequestMessage"/>

    <!-- Reference to the message that will be returned to the requester-->
    <variable name="outputVariable" messageType="client:BPELValidationInvoicesAPEntResponseMessage"/>
    <variable name="varTitle" type="xsd:string"/>
      <variable name="WsMessageTecSendEmailRq" messageType="ns1:MessageRq"/>
   </variables>
   <faultHandlers>
      <catchAll><reply name="replyOutput" partnerLink="bpelvalidationinvoicesapent_client"
                       portType="client:BPELValidationInvoicesAPEnt" operation="ValidationInvoicesAP"
                       variable="outputVariable" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/></catchAll>
   </faultHandlers>
   <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">

    <!-- Receive input from requestor. (Note: This maps to operation defined in BPELValidationInvoicesAPEnt.wsdl) --><receive name="receiveInput" partnerLink="bpelvalidationinvoicesapent_client" portType="client:BPELValidationInvoicesAPEnt" operation="ValidationInvoicesAP" variable="inputVariable" createInstance="yes"/>
    <assign name="AssignTitle" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
         <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
               xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
            <from>oraext:setFlowInstanceTitle('GetDataConfig')</from>
            <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$varTitle</to>
         </copy>
         <extensionAssignOperation>
            <bpelx:remove>
               <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors</bpelx:target>
            </bpelx:remove>
         </extensionAssignOperation>
      </assign>
    <scope name="scopeGetDataValidateInvoicesAP" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
      
      
      <variables>
            <variable name="WsGetConfValInvoicesAPRq" messageType="ns2:GetConfValInvoicesAPRq"/>
            <variable name="WsGetConfValInvoicesAPRs" messageType="ns2:GetConfValInvoicesAPRs"/>
            <variable name="WsERPIntegrationBizGenerateReportRq" messageType="ns5:GenerateReportRq"/>
            <variable name="WsERPIntegrationBizGenerateReportRs" messageType="ns5:GenerateReportRs"/>
            <variable name="WsValidationInvoicesBizValidateInvoicesAPRq" messageType="ns6:ValidateInvoicesAPRq"/>
            <variable name="v_invoices" element="ns7:DATA_DS"/>
            <variable name="v_stringXML" type="xsd:string"/>
         </variables><faultHandlers>
         <catch bpelx:name="Timeout" faultName="bpelx:timeout" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
            <documentation>
               <![CDATA[Control para excepción por Tiempo Expirado durante la llamada a un servicio externo invocado.]]>
            </documentation>
            <assign name="assignTimeout">
               <documentation>
                     <![CDATA[Se asignan los valores correspondientes de la excepción controlada al nodo de Errores que se encuentra en la variable de salida del BPEL.]]>
                  </documentation>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>SOA-00002</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ErrorCode</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>ora:getFaultName()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ShortDescription</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>concat('Exception maxed timeout. ',ora:getFaultAsString())</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[ValidateInvoicesAP]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:BusinessProcess</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[InvoicesEnt]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:FailedService</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>xp20:current-dateTime()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:TimeStamp</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>
                        <Element xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/>
                     </literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</to>
                  </copy>
                  <extensionAssignOperation>
                     <bpelx:remove>
                        <?audit suppress oracle.ide.xml.validation-incomplete?>
                        <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</bpelx:target>
                     </bpelx:remove>
                  </extensionAssignOperation>
               </assign>
         </catch>
         <catch bpelx:name="Remote Fault" faultName="bpelx:remoteFault"
                xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
            <documentation>
               <![CDATA[Control para excepción por Falla Remota a servicio externo invocado.]]>
            </documentation>
            <assign name="assignRemoteFault">
               <documentation>
                     <![CDATA[Se asignan los valores correspondientes de la excepción controlada al nodo de Errores que se encuentra en la variable de salida del BPEL.]]>
                  </documentation>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>SOA-00005</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ErrorCode</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>ora:getFaultName()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ShortDescription</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>concat('Exception when trying to invoke a remote service. ',ora:getFaultAsString())</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[ValidateInvoicesAP]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:BusinessProcess</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[InvoicesEnt]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:FailedService</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>xp20:current-dateTime()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:TimeStamp</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>
                        <Element xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/>
                     </literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</to>
                  </copy>
                  <extensionAssignOperation>
                     <bpelx:remove>
                        <?audit suppress oracle.ide.xml.validation-incomplete?>
                        <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</bpelx:target>
                     </bpelx:remove>
                  </extensionAssignOperation>
               </assign>
         </catch>
         <catch bpelx:name="Selection Failure" faultName="bpel:selectionFailure"
                xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
            <documentation>
               <![CDATA[Control para excepción por Falla en Selección.]]>
            </documentation>
            <assign name="assignSelectionFailure">
               <documentation>
                     <![CDATA[Se asignan los valores correspondientes de la excepción controlada al nodo de Errores que se encuentra en la variable de salida del BPEL.]]>
                  </documentation>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>SOA-00004</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ErrorCode</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>ora:getFaultName()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ShortDescription</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>concat('There have been exceptions when trying to select and set variables. ',ora:getFaultAsString())</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[ValidateInvoicesAP]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:BusinessProcess</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[InvoicesEnt]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:FailedService</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>xp20:current-dateTime()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:TimeStamp</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>
                        <Element xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/>
                     </literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</to>
                  </copy>
                  <extensionAssignOperation>
                     <bpelx:remove>
                        <?audit suppress oracle.ide.xml.validation-incomplete?>
                        <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</bpelx:target>
                     </bpelx:remove>
                  </extensionAssignOperation>
               </assign>
         </catch>
         <catch bpelx:name="Invalid Variables" faultName="bpel:invalidVariables"
                xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
            <documentation>
               <![CDATA[Control para excepción por Variables No Válidas.]]>
            </documentation>
            <assign name="assignInvalidVariables">
               <documentation>
                     <![CDATA[Se asignan los valores correspondientes de la excepción controlada al nodo de Errores que se encuentra en la variable de salida del BPEL.]]>
                  </documentation>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>SOA-00003</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ErrorCode</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>ora:getFaultName()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ShortDescription</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>concat('There have been exceptions when trying set values in variables. ',ora:getFaultAsString())</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[ValidateInvoicesAP]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:BusinessProcess</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>[InvoicesEnt]</literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:FailedService</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>xp20:current-dateTime()</from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:TimeStamp</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                     <from>
                     <literal>
                        <Element xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/>
                     </literal>
                  </from>
                     <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</to>
                  </copy>
                  <extensionAssignOperation>
                     <bpelx:remove>
                        <?audit suppress oracle.ide.xml.validation-incomplete?>
                        <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</bpelx:target>
                     </bpelx:remove>
                  </extensionAssignOperation>
               </assign>
         </catch>
      </faultHandlers>
      <sequence name="seqGetDataValidateInvoicesAP">
         <documentation>
            
         <![CDATA[Secuencia principal para la lógica de la operación que representa el BPEL.]]></documentation>
            <if name="If_ExistConfUser">
               <documentation>
                  <![CDATA[ConfigUser]]>
               </documentation>
               <condition>xp20:upper-case($inputVariable.payload/ns3:ConfiguracionUsuario)='SI'</condition>
               <sequence name="SeqGetConfigUser">
                  <invoke name="WsAuditControlTec-GetConfigData" bpelx:invokeAsDetail="no"
                          partnerLink="WsAuditControlTec" portType="ns2:AuditControlTecPortType"
                          operation="GetConfValInvoicesAP" inputVariable="WsGetConfValInvoicesAPRq"
                          outputVariable="WsGetConfValInvoicesAPRs"/>
                  <if name="If_ExistConfigUser">
                     <documentation>
                        <![CDATA[AssingDefault]]>
                     </documentation>
                     <condition>count($WsGetConfValInvoicesAPRs.GetConfValInvoicesAPRs/ns2:Return/ns2:XxerInvoicesApConfTbl)=0</condition>
                     <assign name="AssignDefault">
                        <extensionAssignOperation>
                           <bpelx:remove>
                              <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$inputVariable.payload/ns3:ConfiguracionUsuario</bpelx:target>
                           </bpelx:remove>
                        </extensionAssignOperation>
                     </assign>
                  </if>
               </sequence>
            </if>
            <assign name="Trs_Config">
               <bpelx:annotation>
                  <bpelx:pattern patternName="bpelx:transformation"></bpelx:pattern>
               </bpelx:annotation>
               <copy>                                                                                                                                                                                                           
                  <from>ora:doXSLTransformForDoc("../Transformations/Trs_ConfigValInvoicesAP.xsl", $inputVariable.payload, "GetConfigValInvoicesAPRs", $WsGetConfValInvoicesAPRs.GetConfValInvoicesAPRs)</from>
                  <to variable="WsValidationInvoicesBizValidateInvoicesAPRq" part="ValidateInvoicesAPRqPart"/>
               </copy>
            </assign>
            <if name="If_ExistConfig">
               <documentation>
                  <![CDATA[ConfigExits]]>
               </documentation>
               <condition>count($WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoValidaciones/ns3:Validacion) &gt; 0</condition>
               <sequence name="Seq">
                  <if name="If_PROD">
                     <documentation>
                        <![CDATA[PROD]]>
                     </documentation>
                     <condition>xp20:upper-case($inputVariable.payload/ns3:Ambiente)='PROD'</condition>
                     <assign name="assignDVMParams">
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                              xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_TARGET_INTERFACE']/ns3:Parametro1</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:TargetInterface</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                              xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_INTEGRATION_NAME']/ns3:Parametro1</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:IntegrationName</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                              xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_PROCESS_NAME']/ns3:Parametro1</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:ProcessName</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                              xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_REPORT_NAME']/ns3:Parametro1</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:ReportName</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                           <from>'NUM_DIAS_INTENTOS'</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[1]/ns5:name</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoValidaciones/ns3:Validacion[ns3:Codigo='V_SAT']/ns3:Parametro4</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[1]/ns5:values/ns5:item</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                           <from>'NUM_INTENTOS'</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[2]/ns5:name</to>
                        </copy>
                        <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                           <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoValidaciones/ns3:Validacion[ns3:Codigo='V_SAT']/ns3:Parametro3</from>
                           <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[2]/ns5:values/ns5:item</to>
                        </copy>
                     </assign>
                     <else>
                        <documentation>
                           <![CDATA[TEST]]>
                        </documentation>
                        <assign name="assignDVMParams" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                                 xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_TARGET_INTERFACE']/ns3:Parametro1</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:TargetInterface</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                                 xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_INTEGRATION_NAME']/ns3:Parametro1</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:IntegrationName</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                                 xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_PROCESS_NAME']/ns3:Parametro1</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:ProcessName</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes"
                                 xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoConfiguraciones/ns3:Configuracion[ns3:Codigo='C_REPORT_NAME_TEST']/ns3:Parametro1</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:ReportName</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                              <from>'NUM_DIAS_INTENTOS'</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[1]/ns5:name</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoValidaciones/ns3:Validacion[ns3:Codigo='V_SAT']/ns3:Parametro4</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[1]/ns5:values/ns5:item</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                              <from>'NUM_INTENTOS'</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[2]/ns5:name</to>
                           </copy>
                           <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                              <from>$WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart/ns6:Config/ns3:CatalogoValidaciones/ns3:Validacion[ns3:Codigo='V_SAT']/ns3:Parametro3</from>
                              <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsERPIntegrationBizGenerateReportRq.GenerateReportRq/ns5:parameterNameValues/ns5:item[2]/ns5:values/ns5:item</to>
                           </copy>
                        </assign>
                     </else>
                  </if>
                  <invoke name="invokeWsERPIntegrationBizGenerateReport" partnerLink="WsERPIntegrationBiz"
                          portType="ns5:ERPIntegrationBizPortType" operation="GenerateReport"
                          inputVariable="WsERPIntegrationBizGenerateReportRq"
                          outputVariable="WsERPIntegrationBizGenerateReportRs"
                          xmlns:bpelx="http://schemas.oracle.com/bpel/extension" bpelx:invokeAsDetail="no">
                     <documentation>
                        <![CDATA[Se invoca a la operación GenerateReport del servicio de Negocio ERPIntegrationBiz.]]>
                     </documentation>
                  </invoke>
                  <assign name="AssignParseStringXML" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
                     <copy ignoreMissingFromData="yes">
                        <from>concat('&lt;DATA_DS xmlns="http://soa.estrellaroja.com.mx/Reports/XXER_AP_INVOICE_VALIDATION_AUTOMATICA"&gt;',substring-after($WsERPIntegrationBizGenerateReportRs.GenerateReportRs/ns5:Return/ns5:xmlOut,'&lt;DATA_DS&gt;'))</from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$v_stringXML</to>
                     </copy>
                     <copy ignoreMissingFromData="yes">
                        <from>oraext:parseXML($v_stringXML)</from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$v_invoices</to>
                     </copy>
                  </assign>
                  <if name="ifValidReport">
                     <documentation>
                        <![CDATA[Continue]]>
                     </documentation>
                     <condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">count($v_invoices/ns7:G_INVOICES)&gt; 0</condition>
                     <sequence name="sequenceInvokeWsInvoicesBiz">
                        <assign name="Trs_ValidateInvoices">
                           <bpelx:annotation>
                              <bpelx:pattern patternName="bpelx:transformation"></bpelx:pattern>
                           </bpelx:annotation>
                           <copy>
                              <from>ora:doXSLTransformForDoc("../Transformations/Trs_ValidateInvoicesAP.xsl", $WsValidationInvoicesBizValidateInvoicesAPRq.ValidateInvoicesAPRqPart, "v_invoices", $v_invoices)</from>
                              <to variable="WsValidationInvoicesBizValidateInvoicesAPRq"
                                  part="ValidateInvoicesAPRqPart"/>
                           </copy>
                        </assign>
                        <invoke name="WsValidationInvoicesBiz-ValidationInvoicesAP"
                                partnerLink="WsValidationInvoicesAPBiz" portType="ns6:ValidationInvoicesAPBizPortType"
                                operation="ValidateInvoicesAP"
                                inputVariable="WsValidationInvoicesBizValidateInvoicesAPRq"
                                xmlns:bpelx="http://schemas.oracle.com/bpel/extension" bpelx:invokeAsDetail="no"/>
                     </sequence>
                     <else>
                        <documentation>
                           <![CDATA[Empty]]>
                        </documentation>
                        <empty name="empty"/>
                     </else>
                  </if>
               </sequence>
               <else>
                  <documentation>
                     <![CDATA[ConfigNotExits]]>
                  </documentation>
                  <assign name="assignFault" xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
      <documentation>
                        <![CDATA[Se asignan los valores correspondientes de la excepción controlada al nodo de Errores que se encuentra en la variable de salida del BPEL.]]>
                     </documentation>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from><literal>SOA-00006</literal></from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ErrorCode</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from>'No exist configuration Default'</from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:ShortDescription</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from>'No exist configuration Default'</from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from><literal>[Get Data Config]</literal></from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:BusinessProcess</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from><literal>[ValidationInvoicesAPEnt]</literal></from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:FailedService</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from>xp20:current-dateTime()</from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Errors/ns4:Error/ns4:TimeStamp</to>
                     </copy>
                     <copy bpelx:insertMissingToData="yes" xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                        <from><literal><Element xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"/></literal></from>
                        <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</to>
                     </copy>
                     <extensionAssignOperation>
                        <bpelx:remove xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                           <?audit suppress oracle.ide.xml.validation-incomplete?>
                           <bpelx:target expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$outputVariable.payload/ns4:Success</bpelx:target>
                        </bpelx:remove>
                     </extensionAssignOperation>
                  </assign>
               </else>
            </if>
      </sequence>
   </scope>
      <if name="If_ExistError">
         <condition>count($outputVariable.payload/ns4:Errors/ns4:Error)&gt;0</condition>
         <sequence name="SeqNotifiaction">
            <assign name="AssignNotifications">
               <copy>
                  <from>dvm:lookupValue("Dvms/ValidationInvoicesAPEnt.dvm","Code","from","Value","er.soa@estrellaroja.com.mx","Component","ValidationAP")</from>
                  <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsMessageTecSendEmailRq.MessageRq/ns1:Message/ns1:Addresses/ns1:AddressFrom</to>
               </copy>
               <copy>
                  <from>$outputVariable.payload/ns4:Errors/ns4:Error/ns4:Description</from>
                  <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsMessageTecSendEmailRq.MessageRq/ns1:Message/ns1:Message</to>
               </copy>
               <copy>
                  <from>dvm:lookupValue("Dvms/ValidationInvoicesAPEnt.dvm","Code","to","Value","pedro.sanchez@forteinnovation.mx","Component","ValidationAP")</from>
                  <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsMessageTecSendEmailRq.MessageRq/ns1:Message/ns1:Addresses/ns1:AddressTo</to>
               </copy>
               <copy>
                  <from>dvm:lookupValue("Dvms/ValidationInvoicesAPEnt.dvm","Code","subject","Value","Validacion Automatica","Component","ValidationAP")</from>
                  <to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">$WsMessageTecSendEmailRq.MessageRq/ns1:Message/ns1:Subject</to>
               </copy>
            </assign>
            <invoke name="WsMessageTec" partnerLink="WsMessageTec" portType="ns1:MessageTecPortType"
                    operation="SendEmail" inputVariable="WsMessageTecSendEmailRq" bpelx:invokeAsDetail="no"/>
         </sequence>
      </if>
      <!-- Generate reply to synchronous request -->
    <reply name="replyOutput" partnerLink="bpelvalidationinvoicesapent_client" portType="client:BPELValidationInvoicesAPEnt" operation="ValidationInvoicesAP" variable="outputVariable"/>
  </sequence>
</process>